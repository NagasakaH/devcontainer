# =============================================================================
# Prefix Key Configuration - Container/Nested Detection
# =============================================================================
# Prefix key switching logic:
#   - Container (Docker/Podman) → Ctrl-a
#   - Nested tmux (TMUX env set) → Ctrl-a  
#   - Normal (host/single tmux)  → Ctrl-b (default)
#
# Detection methods:
#   - /.dockerenv        : Docker container marker file
#   - /run/.containerenv : Podman container marker file
#   - $CONTAINER         : Container environment variable (uppercase)
#   - $container         : Container environment variable (lowercase, systemd-nspawn)
#   - $TMUX_PANE         : Set only when running inside existing tmux session
#                          (Note: $TMUX is not reliable because tmux's if-shell
#                           automatically sets $TMUX even on first startup)
# =============================================================================

# Check if running in container OR nested tmux, then use Ctrl-a as prefix
if-shell 'test -f /.dockerenv || test -f /run/.containerenv || test -n "$CONTAINER" || test -n "$container" || test -n "$TMUX_PANE"' {
    # Container or Nested: Use Ctrl-a as prefix
    set -g prefix C-a
    unbind C-b
    bind C-a send-prefix
    
    # Visual indicator in status bar for container/nested mode
    set -g status-left "[C-a] "
} {
    # Normal: Keep Ctrl-b as prefix (default)
    set -g prefix C-b
    bind C-b send-prefix
    
    # Visual indicator in status bar for normal mode
    set -g status-left "[C-b] "
}

# =============================================================================
# General Settings
# =============================================================================

# True color support
set -g default-terminal "screen-256color"
set-option -sa terminal-overrides ",xterm*:Tc"

# UTF-8 support for icons
setw -q -g utf8 on

# OSC 52 clipboard support - allow passthrough
set -g set-clipboard on

# Pass through environment variables for proper locale
set-option -ga update-environment " LC_ALL LANG"

# Start windows and panes at 1, not 0
set -g base-index 1
setw -g pane-base-index 1
set -g mouse on

# Set Status bar trasnparent
set-option -g status-style bg=default

# =============================================================================
# Window Status Styling
# =============================================================================

# Current window: Highlight with bright cyan and bold for visibility
set -g window-status-current-style "fg=brightcyan,bold"

# Non-current windows: Dimmed appearance
set -g window-status-style "fg=colour244"
