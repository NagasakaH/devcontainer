# Redis Agent Monitor

summoner/moogle/chocoboã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆé–“ã®Redisãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ã™ã‚‹TUIï¼ˆTerminal User Interfaceï¼‰ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€‚

## æ©Ÿèƒ½

### 1. ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¸€è¦§ãƒ»é¸æŠž
- Redisã‹ã‚‰ `summoner:*` ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã‚­ãƒ¼ã‚’ã‚¹ã‚­ãƒ£ãƒ³ã—ã€ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä¸€è¦§è¡¨ç¤º
- ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®è©³ç´°æƒ…å ±ï¼ˆIDã€ä½œæˆæ—¥æ™‚ã€æœ€å¤§å­ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæ•°ãªã©ï¼‰ã‚’ç¢ºèªå¯èƒ½
- ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œã§ç›´æ„Ÿçš„ã«ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’é¸æŠž

### 2. ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºï¼ˆãƒãƒ£ãƒƒãƒˆé¢¨UIï¼‰
- Pub/Subãƒãƒ£ãƒ³ãƒãƒ« `summoner:{session_id}:monitor` ã‚’è³¼èª­
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡è€…ï¼ˆsummoner/moogle/chocobo-Nï¼‰ã”ã¨ã«è‰²åˆ†ã‘ã—ã¦è¡¨ç¤º
- ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ä»˜ãã§æ™‚ç³»åˆ—è¡¨ç¤º
- JSONå½¢å¼ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ•´å½¢ã—ã¦è¡¨ç¤º

### 3. ã‚­ãƒ¥ãƒ¼çŠ¶æ…‹è¡¨ç¤º
- å„ã‚¿ã‚¹ã‚¯ã‚­ãƒ¥ãƒ¼ï¼ˆmoogle â†’ chocoboï¼‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ•°ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤º
- å ±å‘Šã‚­ãƒ¥ãƒ¼ï¼ˆchocobo â†’ moogleï¼‰ã®æœªèª­ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ•°ã‚’è¡¨ç¤º

## ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ•ã‚©ãƒ¼ãƒžãƒƒãƒˆ

```json
// ã‚¿ã‚¹ã‚¯æŒ‡ç¤ºï¼ˆmoogle â†’ chocoboï¼‰
{
  "type": "task",
  "task_id": "001",
  "instruction": "ä½œæ¥­æŒ‡ç¤º",
  "output_dir": "/path/to/output",
  "context": { ... }
}

// å ±å‘Šï¼ˆchocobo â†’ moogleï¼‰
{
  "type": "report",
  "task_id": "001",
  "status": "success|failure",
  "result": "çµæžœæ¦‚è¦",
  "chocobo_id": 1,
  "details": { ... }
}

// çµ‚äº†æŒ‡ç¤º
{
  "type": "shutdown"
}
```

## èµ·å‹•æ–¹æ³•

### æ–¹æ³•1: ã‚·ã‚§ãƒ«ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

```bash
cd /workspaces/devcontainer/scripts/redis-utils
./run_monitor.sh
```

### æ–¹æ³•2: CLIã‚³ãƒžãƒ³ãƒ‰

```bash
redis-monitor
```

### æ–¹æ³•3: Pythonç›´æŽ¥å®Ÿè¡Œ

```bash
cd /workspaces/devcontainer/scripts/redis-utils
.venv/bin/python -m app.monitor.tui_main
```

## ä½¿ã„æ–¹

1. **summonerã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’é–‹å§‹**
   ```bash
   redis-orch --mode summoner --max-children 3
   ```

2. **ãƒ¢ãƒ‹ã‚¿ãƒ¼ã‚’èµ·å‹•**
   ```bash
   redis-monitor
   ```

3. **å·¦ãƒ‘ãƒãƒ«ã§ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’é¸æŠž**
   - ä¸Šä¸‹ã‚­ãƒ¼ã§ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’é¸æŠž
   - Enterã§é¸æŠžç¢ºå®š

4. **ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ã‚’é–‹å§‹**
   - `s` ã‚­ãƒ¼ã§ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°é–‹å§‹/åœæ­¢ã‚’åˆ‡ã‚Šæ›¿ãˆ
   - Pub/Subãƒãƒ£ãƒ³ãƒãƒ«ã®è³¼èª­ãŒé–‹å§‹ã•ã‚Œã¾ã™

5. **moogle/chocoboé–“ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§è¡¨ç¤º**

## ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ

| ã‚­ãƒ¼ | æ©Ÿèƒ½ |
|------|------|
| `q` | çµ‚äº† |
| `r` | ã‚»ãƒƒã‚·ãƒ§ãƒ³å†ã‚¹ã‚­ãƒ£ãƒ³ |
| `s` | ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°é–‹å§‹/åœæ­¢ |
| `c` | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¯ãƒªã‚¢ |
| `d` | è©³ç´°è¡¨ç¤ºãƒˆã‚°ãƒ« |
| `â†‘` / `â†“` | ã‚»ãƒƒã‚·ãƒ§ãƒ³é¸æŠž |
| `Enter` | é¸æŠžç¢ºå®š |

## å‡¡ä¾‹

| ã‚¢ã‚¤ã‚³ãƒ³ | é€ä¿¡è€… | èª¬æ˜Ž |
|---------|--------|------|
| ðŸŒŸ | summoner | ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³åˆ¶å¾¡ |
| ðŸ¾ | moogle | è¦ªã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼ˆã‚¿ã‚¹ã‚¯é…ä¿¡ï¼‰ |
| ðŸ¤ | chocobo-N | å­ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆï¼ˆã‚¿ã‚¹ã‚¯å®Ÿè¡Œï¼‰ |

| ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¿ã‚¤ãƒ— | èª¬æ˜Ž |
|-----------------|------|
| `task` | moogle â†’ chocobo ã¸ã®ã‚¿ã‚¹ã‚¯æŒ‡ç¤º |
| `report` | chocobo â†’ moogle ã¸ã®ä½œæ¥­å ±å‘Š |
| `shutdown` | çµ‚äº†æŒ‡ç¤º |
| `initialized` | ã‚»ãƒƒã‚·ãƒ§ãƒ³åˆæœŸåŒ– |
| `cleanup` | ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ— |

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Redis Agent Monitor (TUI)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Left Panel     â”‚  â”‚        Right Panel               â”‚ â”‚
â”‚  â”‚                  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¸€è¦§   â”‚  â”‚  â”‚     Chat View              â”‚  â”‚ â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚  â”‚  â”‚                            â”‚  â”‚ â”‚
â”‚  â”‚  > session-abc   â”‚  â”‚  â”‚  ðŸ¾ moogle [10:30:15]     â”‚  â”‚ â”‚
â”‚  â”‚    session-xyz   â”‚  â”‚  â”‚  [ã‚¿ã‚¹ã‚¯ 001] ...         â”‚  â”‚ â”‚
â”‚  â”‚                  â”‚  â”‚  â”‚                            â”‚  â”‚ â”‚
â”‚  â”‚  ã‚­ãƒ¥ãƒ¼çŠ¶æ…‹      â”‚  â”‚  â”‚  ðŸ¤ chocobo-1 [10:30:20]  â”‚  â”‚ â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚  â”‚  â”‚  [å ±å‘Š 001] success: ...  â”‚  â”‚ â”‚
â”‚  â”‚  chocobo-1: 0    â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚  chocobo-2: 0    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  reports: 2      â”‚  â”‚  â”‚     Status Bar             â”‚  â”‚ â”‚
â”‚  â”‚                  â”‚  â”‚  â”‚  q:çµ‚äº† r:å†ã‚¹ã‚­ãƒ£ãƒ³ s:é–‹å§‹â”‚  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
app/monitor/
â”œâ”€â”€ __init__.py           # ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åˆæœŸåŒ–
â”œâ”€â”€ tui_main.py           # TUIã‚¢ãƒ—ãƒªã®ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”œâ”€â”€ main.py               # Streamlitã‚¢ãƒ—ãƒªï¼ˆå¾Œæ–¹äº’æ›ã®ãŸã‚æ®‹å­˜ï¼‰
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ session_selector.py  # ã‚»ãƒƒã‚·ãƒ§ãƒ³é¸æŠžã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”œâ”€â”€ chat_view.py         # ãƒãƒ£ãƒƒãƒˆé¢¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
â”‚   â””â”€â”€ queue_status.py      # ã‚­ãƒ¥ãƒ¼çŠ¶æ…‹è¡¨ç¤º
â””â”€â”€ services/
    â”œâ”€â”€ __init__.py
    â”œâ”€â”€ session_scanner.py   # ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¹ã‚­ãƒ£ãƒ³
    â””â”€â”€ pubsub_listener.py   # Pub/Subè³¼èª­
```

## ä¾å­˜é–¢ä¿‚

- Python 3.10+
- textual >= 0.79.0
- redis >= 4.0.0
