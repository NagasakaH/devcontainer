# Channel Viewer

TUIãƒ™ãƒ¼ã‚¹ã®ãƒãƒ£ãƒ³ãƒãƒ«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ“ãƒ¥ãƒ¼ã‚¢ãƒ¼ã§ã™ã€‚è¤‡æ•°ã®ãƒãƒ£ãƒ³ãƒãƒ«ã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§è¡¨ç¤ºã—ã€ãƒãƒ£ãƒ³ãƒãƒ«é–“ã‚’åˆ‡ã‚Šæ›¿ãˆã¦ç›£è¦–ã§ãã¾ã™ã€‚

## æ¦‚è¦

Channel Viewerã¯ã€[Textual](https://textual.textualize.io/)ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’ä½¿ç”¨ã—ãŸã‚¿ãƒ¼ãƒŸãƒŠãƒ«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼ˆTUIï¼‰ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚

### ä¸»ãªæ©Ÿèƒ½

- è¤‡æ•°ãƒãƒ£ãƒ³ãƒãƒ«ã®åŒæ™‚ç›£è¦–
- ãƒãƒ£ãƒ³ãƒãƒ«é–“ã®åˆ‡ã‚Šæ›¿ãˆè¡¨ç¤º
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å—ä¿¡
- æ¥ç¶šçŠ¶æ…‹ã®å¯è¦–åŒ–
- **Redis Pub/Subè³¼èª­æ©Ÿèƒ½**

### ç¾åœ¨ã®å®Ÿè£…çŠ¶æ³

| æ©Ÿèƒ½ | çŠ¶æ…‹ | èª¬æ˜ |
|------|------|------|
| TUIåŸºç›¤ | âœ… å®Œäº† | Textualãƒ™ãƒ¼ã‚¹ã®ãƒãƒ£ãƒ³ãƒãƒ«/ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º |
| ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ | âœ… å®Œäº† | ãƒ€ãƒŸãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ã‚ˆã‚‹ãƒ‡ãƒ¢å‹•ä½œ |
| Redis Pub/Subé€£æº | âœ… å®Œäº† | å®Ÿéš›ã®Redisãƒãƒ£ãƒ³ãƒãƒ«è³¼èª­æ©Ÿèƒ½ |
| Summonerãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚° | âœ… åˆ©ç”¨å¯èƒ½ | summoner:*:monitor ãƒãƒ£ãƒ³ãƒãƒ«ã®è³¼èª­ |

## èµ·å‹•æ–¹æ³•

### å‰ææ¡ä»¶

- Python 3.10ä»¥ä¸Š
- å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿

### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
cd scripts/channel_viewer
pip install -r requirements.txt
```

### èµ·å‹•

```bash
# channel_viewerãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‹ã‚‰
python main.py

# ã¾ãŸã¯ã€ãƒªãƒã‚¸ãƒˆãƒªãƒ«ãƒ¼ãƒˆã‹ã‚‰
python scripts/channel_viewer/main.py
```

## ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰

| ã‚­ãƒ¼ | å‹•ä½œ |
|------|------|
| `n` | æ–°ã—ã„ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ£ãƒ³ãƒãƒ«ã‚’ä½œæˆ |
| `r` | Redisãƒãƒ£ãƒ³ãƒãƒ«ä½œæˆãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’é–‹ã |
| `d` | é¸æŠä¸­ã®ãƒãƒ£ãƒ³ãƒãƒ«ã‚’å‰Šé™¤ |
| `f` | è¡¨ç¤ºã‚’æ›´æ–° |
| `q` | ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³çµ‚äº† |
| `â†‘` / `â†“` | ãƒãƒ£ãƒ³ãƒãƒ«é¸æŠ |

## ç”»é¢æ§‹æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Channel Viewer                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“¡ Channels     â”‚ ğŸ’¬ Messages                                â”‚
â”‚                 â”‚                                            â”‚
â”‚ ğŸŸ¢ General (5)  â”‚ [12:00:00] System: Welcome to General     â”‚
â”‚ ğŸŸ¢ Random (3)   â”‚ [12:00:15] User: Hello everyone           â”‚
â”‚ ğŸŸ¢ Alerts (1)   â”‚ [12:00:30] Bot: Task completed            â”‚
â”‚                 â”‚                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Channels: 3/3 connected | Total Messages: 9                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [n] New  [d] Delete  [r] Refresh  [q] Quit                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒãƒ£ãƒ³ãƒãƒ«çŠ¶æ…‹ã‚¢ã‚¤ã‚³ãƒ³

| ã‚¢ã‚¤ã‚³ãƒ³ | çŠ¶æ…‹ |
|---------|------|
| ğŸŸ¢ | æ¥ç¶šä¸­ï¼ˆConnectedï¼‰ |
| ğŸŸ¡ | æ¥ç¶šä¸­ï¼ˆConnectingï¼‰ |
| âš« | åˆ‡æ–­ï¼ˆDisconnectedï¼‰ |
| ğŸ”´ | ã‚¨ãƒ©ãƒ¼ï¼ˆErrorï¼‰ |

### ãƒãƒ£ãƒ³ãƒãƒ«ã‚¿ã‚¤ãƒ—ã‚¢ã‚¤ã‚³ãƒ³

| ã‚¢ã‚¤ã‚³ãƒ³ | ã‚¿ã‚¤ãƒ— |
|---------|------|
| ğŸ’¬ | ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ£ãƒ³ãƒãƒ« |
| ğŸ“¡ | Redis Pub/Subãƒãƒ£ãƒ³ãƒãƒ« |

## ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
channel_viewer/
â”œâ”€â”€ main.py           # ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”œâ”€â”€ tui.py            # TUIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆTextualã‚¢ãƒ—ãƒªï¼‰
â”œâ”€â”€ channel.py        # ãƒãƒ£ãƒ³ãƒãƒ«ç®¡ç†ã‚¯ãƒ©ã‚¹
â”œâ”€â”€ message.py        # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ‡ãƒ¼ã‚¿æ§‹é€ 
â”œâ”€â”€ simulator.py      # ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç”Ÿæˆ
â”œâ”€â”€ redis_channel.py  # Redis Pub/Subè³¼èª­æ©Ÿèƒ½
â”œâ”€â”€ requirements.txt  # ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸
â””â”€â”€ README.md         # ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«
```

## Redis Pub/Subè³¼èª­

### TUIã§ã®ä½¿ç”¨æ–¹æ³•

1. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’èµ·å‹•: `python main.py`
2. `r`ã‚­ãƒ¼ã‚’æŠ¼ã—ã¦Redisãƒãƒ£ãƒ³ãƒãƒ«ä½œæˆãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’é–‹ã
3. è³¼èª­ã—ãŸã„ãƒãƒ£ãƒ³ãƒãƒ«åã‚’å…¥åŠ›ï¼ˆä¾‹: `summoner:abc123:monitor`ï¼‰
4. Host/Portã‚’ç¢ºèªï¼ˆDockerç’°å¢ƒã§ã¯`redis:6379`ï¼‰
5. Enterã¾ãŸã¯"Create"ãƒœã‚¿ãƒ³ã§ä½œæˆ

### Summonerã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã®é€£æº

Summonerã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯ã€`orchestration-init --summoner-mode` ãŒ `monitor_channel` ã‚’ç”Ÿæˆã—ã¾ã™ã€‚

```bash
# 1. ã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ–
python skills/orchestration-init/scripts/init_orchestration.py \
  --summoner-mode --max-children 3 --json > /tmp/config.json

# 2. monitor_channelã‚’å–å¾—
MONITOR_CHANNEL=$(jq -r .monitor_channel /tmp/config.json)
echo "Monitor channel: ${MONITOR_CHANNEL}"
# å‡ºåŠ›ä¾‹: summoner:a1b2c3d4-...:monitor

# 3. channel_viewerã§ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°
python scripts/channel_viewer/main.py
# TUIå†…ã§ r ã‚’æŠ¼ã—ã¦ ${MONITOR_CHANNEL} ã‚’è³¼èª­
```

### ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ï¼ˆåˆ¥ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ï¼‰

```bash
python skills/redis-rpush-sender/scripts/rpush.py \
  --channel summoner:abc123:monitor \
  summoner:abc123:tasks:1 \
  '{"type":"task","content":"Hello"}'
```

### ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å½¢å¼

Pub/Subã§å—ä¿¡ã™ã‚‹JSONãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼š

```json
{
  "queue": "summoner:abc123:tasks:1",
  "message": "{\"type\":\"task\",\"content\":...}",
  "timestamp": "2025-01-29T12:00:00+00:00"
}
```

TUIã§ã®è¡¨ç¤ºï¼š

```
[12:00:00] redis: [task] summoner:abc123:tasks:1: content_preview
```

## ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```mermaid
flowchart TB
    subgraph TUI["Channel Viewer TUI"]
        App[ChannelViewerApp]
        Manager[ChannelManager]
        Display[MessageDisplay]
        List[ChannelList]
        
        App --> Manager
        App --> Display
        App --> List
        Manager --> |update| Display
        Manager --> |update| List
    end
    
    subgraph Channels["ãƒãƒ£ãƒ³ãƒãƒ«"]
        Ch1[Channel 1<br/>Simulation]
        Ch2[Channel 2<br/>Simulation]
        Ch3[Channel 3<br/>Redis Pub/Sub]
    end
    
    subgraph Sources["ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚½ãƒ¼ã‚¹"]
        Sim[Simulator]
        Redis[(Redis Server)]
    end
    
    Sim --> Ch1
    Sim --> Ch2
    Redis -->|SUBSCRIBE| Ch3
    
    Manager --> Ch1
    Manager --> Ch2
    Manager --> Ch3
```

## é–‹ç™ºè€…å‘ã‘æƒ…å ±

### ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸

- `textual>=0.40.0` - TUIãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯

### Redis Pub/Subå®Ÿè£…ã«ã¤ã„ã¦

- `redis_channel.py`ã§RESPãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’ç›´æ¥ä½¿ç”¨ï¼ˆå¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªä¸è¦ï¼‰
- å„ãƒãƒ£ãƒ³ãƒãƒ«ã”ã¨ã«ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚¹ãƒ¬ãƒƒãƒ‰ã§SUBSCRIBE
- å—ä¿¡ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’`Channel.add_message()`ã§è¿½åŠ 

## é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [orchestration-init/SKILL.md](../../skills/orchestration-init/SKILL.md) - Summonerãƒ¢ãƒ¼ãƒ‰ã¨`monitor_channel`ã®è©³ç´°
- [redis-rpush-sender/SKILL.md](../../skills/redis-rpush-sender/SKILL.md) - `--channel`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«ã‚ˆã‚‹Pub/Subé€šçŸ¥
- [summoner.agent.md](../../agents/summoner.agent.md) - Summonerã‚ªãƒ¼ã‚±ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®å…¨ä½“åƒ
