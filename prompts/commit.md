# Git Commit コマンド

MCP連携を活用してチケット情報を取得し、適切なコミットメッセージを生成してコミットを実行します。

## 処理フロー

以下の手順でコミットを実行してください。

### 1. 現在のブランチ名を取得

```bash
git branch --show-current
```

### 2. ブランチ名からチケットIDを抽出

以下のパターンからチケットIDを抽出してください：

| ブランチパターン         | 抽出対象            |
| ------------------------ | ------------------- |
| `feature/<チケットID>-*` | `<チケットID>` 部分 |
| `issue/<チケットID>-*`   | `<チケットID>` 部分 |
| `bugfix/<チケットID>-*`  | `<チケットID>` 部分 |
| `hotfix/<チケットID>-*`  | `<チケットID>` 部分 |
| `fix/<チケットID>-*`     | `<チケットID>` 部分 |

**チケットIDの例:**

- GitHub/GitLab Issue: `123`, `456`
- Jira: `PROJ-123`, `ABC-456`
- Redmine: `#123`, `123`

### 3. 利用可能なMCPを確認してチケット情報を取得

チケットIDのフォーマットに応じて、適切なMCPを使用してチケット情報を取得してください。

#### GitHub Issues（MCPが利用可能な場合）

チケットIDが数値のみの場合、GitHub MCPの `github-mcp-server-issue_read` を使用：

```
method: get
owner: <リポジトリオーナー>
repo: <リポジトリ名>
issue_number: <チケットID>
```

#### GitLab Issues（MCPが利用可能な場合）

GitLab MCPが利用可能な場合、該当するツールでIssue情報を取得してください。

#### Jira（Atlassian MCPが利用可能な場合）

チケットIDが `PROJ-123` 形式の場合、Atlassian/Jira MCPを使用してチケット情報を取得してください。

#### Redmine（Redmine MCPが利用可能な場合）

Redmine MCPが利用可能な場合、該当するツールでチケット情報を取得してください。

#### MCPが利用できない場合

ブランチ名から推測できる情報のみを使用してコミットメッセージを生成してください。

- チケットID: ブランチ名から抽出したID
- タイトル: ブランチ名のID以降の部分をタイトルとして使用（ハイフンをスペースに置換）

### 4. 変更内容を確認

```bash
git status
git diff --cached --stat
git diff --cached
```

ステージングされていない変更がある場合は、ユーザーに確認してください。

### 5. コミットメッセージを生成

以下のフォーマットでコミットメッセージを生成してください：

```
refs #<チケットID> <チケットタイトル>

<実際の対応内容の要約>
```

**例:**

```
refs #123 ログイン機能の実装

- ログインフォームコンポーネントを追加
- 認証APIとの連携を実装
- バリデーション処理を追加
```

### 6. ユーザーに確認

生成したコミットメッセージをユーザーに提示し、以下を確認してください：

1. コミットメッセージの内容は適切か
2. 修正が必要な場合は修正内容を聞く
3. コミットを実行してよいか

### 7. コミット実行

ユーザーの承認後、コミットを実行：

```bash
git commit -m "<生成したコミットメッセージ>"
```

## 注意事項

- ステージングされた変更がない場合は、何をステージングするか確認してください
- コミットメッセージは必ずユーザーに確認を取ってから実行してください
- MCPが利用できない場合でも、ブランチ名から最低限の情報を抽出して処理を継続してください
- 複数のチケットに関連する変更の場合は、ユーザーに確認して適切なチケットIDを選択してください

## リポジトリ情報の取得方法

GitHub/GitLabのリポジトリ情報は以下のコマンドで取得できます：

```bash
git remote get-url origin
```

出力例からowner/repoを抽出：

- `https://github.com/owner/repo.git` → owner: `owner`, repo: `repo`
- `git@github.com:owner/repo.git` → owner: `owner`, repo: `repo`
