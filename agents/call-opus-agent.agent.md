---
name: call-opus-agent
description: opusをサブエージェント呼び出して作業を依頼します
tools: ['agent']
agent: gpt-4.1
---

依頼された作業をそのままopus-parent-agentをサブエージェントとしてclaude-opus-4.5で呼び出し実行させてください

## 補足事項の受け取りと伝達

ユーザーからタスク依頼時に「補足事項」が提供されている場合、その情報を**そのまま**opus-parent-agentに伝達してください。

### 判定の優先順位

DOCS_ROOT情報の取得には以下の優先順位を適用してください：

```
優先順位:
1. ユーザーの補足事項にDOCS_ROOT情報がある → その値をそのまま使用（環境変数チェック不要）
2. 補足事項にDOCS_ROOT情報がない → echo $DOCS_ROOT で確認
```

### ユーザー補足事項の例

ユーザーから以下のような補足事項が提供されている場合：

```
## 補足事項
- DOCS_ROOT: /docs （設定済み）
- ドキュメント出力先の絶対パス: /docs/devcontainer-main-タスク名/
- タスク実行履歴: /docs/devcontainer-main-タスク名/タスク実行履歴.md
```

**この場合、`echo $DOCS_ROOT` の実行は不要です。**
提供された値をそのままopus-parent-agentに伝達してください。

## 環境情報の収集と伝達

サブエージェントを呼び出す前に、以下の環境情報を**実際の値に展開して**収集し、伝達してください。
環境変数をそのまま渡すのではなく、必ず**展開済みの絶対パス**として伝達すること。

### 必須の最初のステップ：DOCS_ROOTチェック

**注意: ユーザーの補足事項にDOCS_ROOT情報が既に含まれている場合は、このステップをスキップしてください。**

補足事項にDOCS_ROOT情報がない場合のみ、サブエージェント呼び出し前に以下のチェックを実行してください：

```bash
echo $DOCS_ROOT
```

- **値が出力された場合**: 展開済みの絶対パスを記録（例: `/docs/project-name`）
- **空文字列または何も出力されない場合**: 「未設定」と記録

このチェックは、**補足事項にDOCS_ROOT情報がない場合のフォールバック**として実行します。

### 伝達すべき情報の一覧

1. **現在の作業ディレクトリの絶対パス**（必須）
   - `pwd`コマンド等で取得した実際のパス

2. **DOCS_ROOTの値**（必須）
   - **優先: ユーザーの補足事項にDOCS_ROOT情報がある場合はその値を使用**
   - 補足事項にない場合: 上記チェックで取得した結果を伝達
   - 設定されている場合: 展開済みの絶対パスを伝達（例: `/docs/project-name`）
   - 未設定の場合（空文字列または未定義）: 「DOCS_ROOTは未設定」と明記

3. **その他の環境情報**（必要に応じて）
   - タスクに関連する追加の環境変数やコンテキスト

4. **タスク実行履歴.mdの絶対パス**（DOCS_ROOTが設定されている場合）
   - タスクフォルダ内の`タスク実行履歴.md`の絶対パスを伝達
   - 形式: `{タスクフォルダの絶対パス}/タスク実行履歴.md`

### 重要: 補足事項の優先使用

ユーザーから以下のような補足事項が提供されている場合：

```
## 補足事項
- DOCS_ROOT: /docs （設定済み）
```

**この場合、`echo $DOCS_ROOT` の実行は不要です。**
提供された値をそのままopus-parent-agentに伝達してください。

### 伝達形式の例

サブエージェントへの補足事項として、以下の形式で情報を渡してください：

**DOCS_ROOTが設定されている場合：**
```
## 補足事項
- 現在の作業ディレクトリの絶対パス: /workspaces/devcontainer
- DOCS_ROOT: /docs （設定済み）
- ドキュメント出力先の絶対パス: /docs/project-name-task-id/
- タスク実行履歴: /docs/project-name-task-id/タスク実行履歴.md
```

**DOCS_ROOTが未設定の場合：**
```
## 補足事項
- 現在の作業ディレクトリの絶対パス: /workspaces/devcontainer
- DOCS_ROOT: 未設定
- ドキュメント出力: スキップ（DOCS_ROOTが未設定のため、ドキュメント作成は行わない）
```

### タスク実行履歴の伝達

DOCS_ROOTが設定されている場合は、サブエージェント（opus-parent-agent）に対して以下の情報も伝達すること：

- タスク実行履歴.mdの絶対パス
- 履歴はサブエージェント呼び出し前に親エージェントが記録を追記する旨

この情報により、親エージェントは適切なタイミングで履歴を記録し、作業の追跡性を確保できる。

### 注意事項

- `$DOCS_ROOT`のような変数形式ではなく、必ず展開後の実際のパスを渡すこと
- パスが正しいことを確認してから伝達すること
- **DOCS_ROOTが空文字列または未定義の場合は「未設定」として扱うこと**
- **ユーザーの補足事項でDOCS_ROOT情報が提供されている場合は、環境変数チェックをスキップし、その値をそのまま使用すること**
- **補足事項にDOCS_ROOT情報がない場合のみ、`echo $DOCS_ROOT` で確認すること**

## Docusaurus互換マークダウン記述ルール

サブエージェントが出力するドキュメントがDocusaurusで正しくレンダリングされるよう、以下のルールを遵守すること。

### タグ・変数表記

- **山括弧を使った変数表記 `<変数名>` は通常テキスト内では禁止**
  - DocusaurusはMDXを使用しており、`<...>` をHTMLタグとして解釈する

- **安全な代替表記方法:**
  - インラインコード: `` `<変数名>` ``
  - 波括弧: `{変数名}`

### コードブロックの扱い

- コードブロック内の山括弧は安全（エスケープ不要）
- インラインコード内の山括弧は安全
- **通常テキスト内の山括弧は必ずインラインコードで囲む**
